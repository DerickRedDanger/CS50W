{% extends 'base_calendar.html' %}
{% block script%}
  <script>
console.log("it worked!")
    </script>
{% endblock %}
{% block style%}
  <style>
    

    
    </style> 
{% endblock%}
{% block content %}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

<body>
    <h2>Snackbar / Toast</h2>
  <p>Snackbars are often used as a tooltips/popups to show a message at the bottom of the screen.</p>
  <p>Click on the button to show the snackbar. It will disappear after 3 seconds.</p>

  <button onclick="Snackbar()">Show Snackbar</button>

  <div >Some text some message..</div>

<!-- Snackbar -->
<span style="color:red" > remove the below at the end of the project</span><br>
<button onclick="Snackbar()">Show Snackbar</button><br>
snackbar = {{Snackbar}}<br>
alert = {{alert}}<br>
{% if Snackbar %}
  {% if alert == 'success' %}
  <div id="Snackbar" class="Snackbar alert success">
    <span onclick="Close()" class="closebtn">&times;</span>  
    <strong>Success!</strong> {{Snackbar}}
  </div>
  {% elif alert == 'info'  %}
  <div id="Snackbar" class="Snackbar alert info">
    <span onclick="Close()" class="closebtn">&times;</span>  
    <strong>Info!</strong> {{Snackbar}}
  </div>
  {% elif alert == 'warning'  %}
  <div id="Snackbar" class="Snackbar alert warning">
    <span onclick="Close()" class="closebtn">&times;</span>  
    <strong>Warning!</strong> {{Snackbar}}
  </div>
  {% elif alert == 'alert'  %}
  <div id="Snackbar" class="Snackbar alert">
    <span onclick="Close()" class="closebtn">&times;</span>  
    <strong>Danger!</strong> {{Snackbar}}
  </div>

{% endif %}
{% endif %}

<!-- Right Sidenav - button -->
<div id="RSOpenBtn" class="RSOpenBtn" style="font-size:30px;cursor:pointer" data-open ='1' onclick="openRNav()">
  o<br>p<br>e<br>n
   </div>
 
      <!-- Right Sidenav -->
   <div id="RSidenav" class="RSidenav ">

    <!-- Sort button -->
    <div>
      Sort:<div id="sort">
    <button id = "sort_importance" class="sort_button" data-criteria="importance" data-orders="asc" data-priority=-1 > by importance </button>
    <button id = "sort_date" class="sort_button" data-criteria="date" data-orders="asc" data-priority=-1 > by date </button>
    </div>
    <!-- Search's input -->
    
      <input type="text" id="search" onkeyup="Search(Case,where)" placeholder="Search for ..." title="Search">
      
      <select name="search_options" id="search_options" style="background-color:grey" onchange="updateSearch();Search(Case,where);">
        <option value="title" selected=""> Title only </option>
      
        <option value="date"> Title and date </option>
      
        <option value="everywhere" >Title, date, descriptions and note</option>
      </select>

      <label for="Case">Case sensitive?</label>
        <input type="checkbox" name="Case" id="Case" onclick="updateSearch();Search(Case,where);">
    </div>
    {% for object in events%}

    <div class="list" data-importance ="{{object.importance}}" data-date ="{{object.day}}" data-year = "{{object.day.year}}"
     data-month = "{{object.day.month}}" data-day ="{{object.day.day}}" data-deadline="{{object.deadline_date}}"> <a href="{{object.get_absolute_url}}">
     {{object.title}}</a>
     <br>{{object.day}} - {{object.start_time}} - {{object.end_time}} -
    
    {% if object.importance == "5" %} <span class="glyphicon glyphicon-alert" style="color:red"></span>&nbsp;<br>
    {% elif object.importance == "4" %} <span class="glyphicon glyphicon-alert" style="color:orange"></span>&nbsp;<br>
    {% elif object.importance == "2" %} <span class="glyphicon glyphicon-alert" style="color:green"></span> &nbsp;<br>
    {% elif object.importance == "1" %} <span class="glyphicon glyphicon-alert" style="color: blue"></span>&nbsp;<br>
    {% elif object.importance == "0" %} <span class="glyphicon glyphicon-alert" style="color: LightBlue"></span>&nbsp;<br>
    {% elif object.importance == "3" %} <span class="glyphicon glyphicon-question-sign" style="color: orange"></span>&nbsp;<br>{% endif %}

    {% if object.short_description %}
    Short description: {{object.short_description}} <br>
    {% endif %}

    {% if object.description or object.notes %}
    <input type="button" class = "more" id =' more{{object.id}}' style="background-color:grey;" data-id ='{{object.id}}' value="More info">
    {% if object.description %}
    <input type="button" class = "desciption" id="des{{object.id}}" style="background-color:grey;display:none;" data-id ='{{object.id}}' value="Description:" > 
    <span style="display:none" id="description{{object.id}}"><br>{{object.description}}<br></span> 
    {% endif %}
    {% if object.notes%}
    <input type="button" class = "notes" id = "not{{object.id}}" style="background-color:grey;display:none;" data-id ='{{object.id}}' value="Notes:" > 
    <span style="display:none" id="notes{{object.id}}"> <br> {{object.notes}} <br></span>
    {% endif %}
    {% endif %}
  </div>

    {% endfor %}
 </div>
 
 

 

 
</div>
<!---->
   </div>

   <p>Click the button to sort the list by urgency:</p>
   <p><button onclick="sortList('RSidenav','importance')">Sort</button></p>
   <p>Click the button to sort the list by date:</p>
   <p><button onclick="sortList('RSidenav','date')">Sort</button></p>
</body>
<!--
  document.getElementById("RSidenav").children
-->

<script>

  

  
  </script>
  <button id = "sort_importance" data-criteria="importance" data-order="desc" data-place="0" onclick="sortList('RSidenav','importance');arrowUpdate('importance');" style="background-color:grey"> by importance &uarr; </button>
  <button id = "sort_date" data-arrow="up" onclick="sortList('RSidenav','date');arrowUpdate('date');" style="background-color:grey"> by date &uarr;</button> </p>

<script>

  // Getting a array of the sort buttons to use in the sort functions
  let sort_buttons = Array.from(document.getElementById('sort').children)
  console.log(`Sort buttons are = ${sort_buttons}`)
  console.dir(sort_buttons)

  let buttons_original_Html = [];
  for( i=0; i < sort_buttons.length; i++){
    buttons_original_Html.push(sort_buttons[i].innerHTML);
  }
  console.dir(buttons_original_Html)


  let criteria = [0,0,0]
  let orders = [0,0,0]
  let clicks = [0,0,0]

  // Creats a array of objects based on criteria and orders, make
  let sort_rules = criteria.map((item, index) => ({criteria: item, orders: orders[index], clicks: clicks[index]}));
  console.dir(sort_rules)

  // to do a function once the DOM is loaded
  document.addEventListener("DOMContentLoaded", function() {
    inicialize_buttons();
    console.log("sort buttons")
    console.dir(sort_buttons)
    for (let i = 0; i < sort_buttons.length; i++) {
      sort_buttons[i].addEventListener('click', function() {
        console.dir(this)
        Sort_rules_update(this);
        sort_list();
        sort_button_upate();



        

          // Your code here
      });
    }
    // !!!!!!
    // Need to add the Sort_rules_Update, sort function and sort_button_upate to each button
    // and mdify the sort function to work with the sort_rules array
    // Once tests are completed, move the this addevent listened, inicialize_buttons(),
    // Sort_rules_Update(), sort_button_upate() and the script abve to base_scripts
    //!!!!
  });

  function inicialize_buttons(){
    for (let i = 0; i < sort_buttons.length; i++) {
      let newElementBeforeButton = document.createElement('span');
      let Button = sort_buttons[i];
      newElementBeforeButton.id ="+" + sort_buttons[i].id;
      newElementBeforeButton.innerHTML = '';

      Button.parentNode.insertBefore(newElementBeforeButton, Button);

      let newElementAfterButton = document.createElement('span');
      newElementAfterButton.id = sort_buttons[i].id + "+";
      newElementAfterButton.innerHTML = '';

      Button.parentNode.insertBefore(newElementAfterButton, Button.nextSibling);
    }
  }
  


  first = 0;
  second = 0;
  third = 0;
  order1 = "desc";
  order2 = "desc";
  order3 = "desc";

  // Function to upadate the sort rules, based on the sort button clicked
  function Sort_rules_update(element){

    //Loop inside sort_rules and check if this element's criteria is inside it.
    for (let i = 0; i < sort_rules.length; i++) {
      // If it find a empty criteria overwrite it with this element's, 
      // update the elements priority to i and break.
      if (sort_rules[i].criteria === 0){
        sort_rules[i].criteria = element.dataset.criteria;
        sort_rules[i].orders = element.dataset.orders;
        sort_rules[i].clicks++ ;
        element.dataset.priority = i
        break
        // If this element is already inside it, check if this is the third time it's clicked
        // If it's reset it to 0, reset the button's dataset to the initial and break
      } else if (sort_rules[i].criteria === element.dataset.criteria)
        if (sort_rules[i].clicks >= 2){
          sort_rules[i].criteria = 0;
          sort_rules[i].orders = 0;
          sort_rules[i].clicks = 0;
          element.dataset.orders = "asc"
          element.dataset.priority = -1
          break
          
          // if it isn't the third time, increase the number of times it was clicked
          // update the element's dataset.orders and break
        } else {
          element.dataset.orders = "desc"
          sort_rules[i].orders = element.dataset.orders;
          sort_rules[i].clicks++ ;
          break
        }
    }

    // Loops inside the sort_rule again, checking for empty criterias. If found,
    // check if there is another criteria after it, if there is, replace the current with the next
    // criteria and reset the next. effectively moving empty criterias to the end of the array.
    for (let i = 0; i < sort_rules.length; i++) {
      if (sort_rules[i].criteria === 0 && i + 1 < sort_rules.length && sort_rules[i+1].criteria !==0){
        sort_rules[i].criteria = sort_rules[i+1].criteria;
        sort_rules[i].orders = sort_rules[i+1].orders;
        sort_rules[i].clicks = sort_rules[i+1].clicks;
        sort_rules[i+1].criteria = 0;
        sort_rules[i+1].orders = 0;
        sort_rules[i+1].clicks = 0;
      }
    }

    // Updates the buttons dataset
    for (let i = 0; i < sort_buttons.length; i++){
      let button_inside_rule = "0"
      for (let j = 0; j < sort_rules.length; j++){
        if (sort_rules[j].criteria == sort_buttons[i].dataset.criteria){
          button_inside_rule= "1"
          sort_buttons[i].dataset.priority=j
        }
      }
        if(button_inside_rule == "0"){
          sort_buttons[i].dataset.priority=-1
        }
    }
  }

  // Function that updates the sort button's value based on it's presence/or lack in the sort rules
  function sort_button_upate(){
    frontOptions = ["1°", "2°", "3°"]
    behindOptions = ["&uarr;", "&darr;"]


    // Loops thought the buttons inside the array
    for (let i = 0; i < sort_buttons.length; i++) {
      // get it's criteria, order, and the Id of the span before and after it.
      let priority = sort_buttons[i].dataset.priority;
      let order = sort_buttons[i].dataset.orders;
      let element = sort_buttons[i]
      console.log(`element`)
      console.dir(element)
      console.log(`priority = ${priority}`)
      console.log(`order = ${order}`)


      switch (priority) {
        // if the criteria is -1 (not in the sort rule)
        // the element before and after it has it's HTML =""
        case "-1":
          console.log("case -1")
          if(element.innerHTML!== buttons_original_Html[i]){
            element.innerHTML = buttons_original_Html[i]
            }
          break;
        // othersie the element before has it's HTML to it's priority's order
        case "0":
          console.log("case 0")
          if(order == "asc" && element.innerHTML !== frontOptions[0] + " " + buttons_original_Html[i] + " " + behindOptions[0]){
            element.innerHTML = frontOptions[0] + " " + buttons_original_Html[i] + " " + behindOptions[0];

          } else if (order == "desc" && element.innerHTML!==frontOptions[0] + " " + buttons_original_Html[i] + " " + behindOptions[1]){
            element.innerHTML = frontOptions[0] + " " + buttons_original_Html[i] + " " + behindOptions[1];
          }
          break;

        case "1":
          console.log("case 1")
          if(order == "asc" && element.innerHTML!==frontOptions[1] + " " + buttons_original_Html[i] + " " + behindOptions[0]){
            element.innerHTML = frontOptions[1] + " " + buttons_original_Html[i] + " " + behindOptions[0];

          } else if (order == "desc" && element.innerHTML!==frontOptions[1] + " " + buttons_original_Html[i] + " " + behindOptions[1]){
            element.innerHTML = frontOptions[1] + " " + buttons_original_Html[i] + " " + behindOptions[1];
          }
          break;

        case "2":
        console.log("case 2")
          if(order == "asc" && element.innerHTML!==frontOptions[2] + " " + buttons_original_Html[i] + " " + behindOptions[0]){
            element.innerHTML = frontOptions[2] + " " + buttons_original_Html[i] + " " + behindOptions[0];

          } else if (order == "desc" && element.innerHTML !== frontOptions[2] + " " + buttons_original_Html[i] + " " + behindOptions[1]){
            element.innerHTML = frontOptions[2] + " " + buttons_original_Html[i] + " " + behindOptions[1];
          }
          break;

        default:
          break;
      }
    }
  }


  
  </script>

  <div id="myDiv">
    <p data-day="Monday" data-priority="high">Task 1</p>
    <p data-day="Tuesday" data-priority="low">Task 2</p>
    <p data-day="Wednesday" data-priority="medium">Task 3</p>
</div>
</body>
<script>
let div = document.querySelector('#myDiv');
let elements = Array.from(div.children);
console.log(elements);
console.log("it worked");
</script>

{% endblock %}

